<div class="app-shell" data-controller="sidebar">
  <%# Sidebar %>
  <aside class="sidebar" data-sidebar-target="panel">
    <div class="sidebar__top">
      <div class="sidebar__brand">
        <%= image_tag "Logo SimpliCity.png", alt: "Logo SimpliCity" %>
      </div>

      <div class="sidebar__section">
        <div class="sidebar__label">REGI√ìN</div>
        <select class="sidebar__select" data-sidebar-target="regionSelect" data-action="change->sidebar#regionChanged">
          <option>Seleccionar regi√≥n...</option>
        </select>
      </div>

      <div class="sidebar__section">
        <div class="sidebar__label">COMUNA</div>
        <select class="sidebar__select" data-sidebar-target="municipalitySelect" data-action="change->sidebar#municipalityChanged">
          <option>Seleccionar comuna...</option>
        </select>
      </div>

      <div class="sidebar__section">
        <div class="sidebar__label">OPORTUNIDADES</div>
        <select class="sidebar__select" data-sidebar-target="opportunitySelect" data-action="change->sidebar#opportunityChanged" disabled>
          <option>Seleccionar oportunidad</option>
        </select>
        <div class="sidebar__hint">
          Selecciona primero una comuna en el mapa o en el buscador
        </div>
      </div>

      <div class="sidebar__divider"></div>

      <div class="sidebar__section" data-sidebar-target="layerSection" hidden>
        <div class="sidebar__label">CAPAS DE DATOS</div>

        <div class="sidebar__layers">
          <button
            type="button"
            class="sidebar__layer-btn"
            data-metric="surface"
            data-action="click->sidebar#selectLayer"
          >
            <i class="fa-solid fa-square"></i>Superficie construida
          </button>

          <button
            type="button"
            class="sidebar__layer-btn"
            data-metric="units"
            data-action="click->sidebar#selectLayer"
          >
            <i class="fa-solid fa-building"></i>Unidades construidas
          </button>

          <button
            type="button"
            class="sidebar__layer-btn"
            data-action="click->sidebar#selectLayer"
          >
            üö∂ Accesibilidad
          </button>
        </div>
      </div>

      <div
        class="sidebar__section"
        data-sidebar-target="locateSection"
        hidden
      >
        <button
          type="button"
          class="sidebar__primary-btn"
          data-action="click->sidebar#toggleLocator"
        >
          üìç Localizar infraestructura
        </button>
      </div>



    <div class="sidebar__bottom">
      <button class="sidebar__link" type="button">
        <span class="sidebar__icon">‚öôÔ∏è</span> Configuraci√≥n
      </button>
      <button class="sidebar__link" type="button">
        <span class="sidebar__icon">‚ùî</span> Ayuda
      </button>
    </div>
  </aside>

  <!-- Sidebar secundaria (Localizador) -->
  <aside class="sidebar sidebar--secondary" data-sidebar-target="locatorPanel" hidden>
    <div class="sidebar__top">
      <button type="button" class="sidebar__close-btn" data-action="click->sidebar#toggleLocator">
        ‚úñ
      </button>
      <div class="sidebar__brand">Localizador</div>

      <div class="sidebar__section">
        <div class="sidebar__label">OPORTUNIDAD</div>
        <select class="sidebar__select" data-sidebar-target="locatorOpportunitySelect" disabled>
          <option>Seleccionar oportunidad</option>
        </select>
      </div>

      <div class="sidebar__section">
        <div class="sidebar__label">UNIDADES</div>
        <input
          class="sidebar__input"
          type="number"
          min="1"
          step="1"
          inputmode="numeric"
          placeholder="Ej: 10"
          data-sidebar-target="unitsInput"
        />
      </div>

      <div class="sidebar__section">
        <div class="sidebar__label">SUPERFICIE POR UNIDAD</div>
        <input
          class="sidebar__input"
          type="number"
          min="1"
          step="1"
          inputmode="numeric"
          placeholder="Ej: 65"
          data-sidebar-target="areaPerUnitInput"
        />
      </div>

      <div class="sidebar__section">
        <button type="button" class="sidebar__primary-btn" data-sidebar-target="addBtn">
          Agregar
        </button>
      </div>

      <div class="sidebar__section">
        <button type="button" class="sidebar__secondary-btn" data-sidebar-target="saveRecalcBtn">
          Guardar y recalcular
        </button>
      </div>
    </div>
  </aside>


  <!-- Bot√≥n de colapsar -->
  <button
    class="sidebar__collapse"
    type="button"
    aria-label="Colapsar sidebar"
    data-action="click->sidebar#toggle"
    data-sidebar-target="toggle"
  >
    ‚Äπ
  </button>

  <main class="map-area" data-sidebar-target="mapArea">
    <div
      id="map"
      class="map"
      data-controller="map"
      data-map-token-value="<%= ENV.fetch("MAPBOX_TOKEN", "") %>"
    ></div>

    <%# Botones flotantes (derecha) %>
    <div class="map-fab">
      <button type="button" class="map-fab__btn" aria-label="Mapa">
        <i class="fa-solid fa-map"></i>
      </button>

      <button type="button" class="map-fab__btn" aria-label="Gr√°fico">
        <i class="fa-solid fa-chart-bar"></i>
      </button>

      <button type="button" class="map-fab__btn" aria-label="Capas">
        <i class="fa-solid fa-list"></i>
      </button>
    </div>
  </main>
</div>
